# -*- coding: utf-8 -*-
"""2nd_graph.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1F-dtZ8hkO987SOPfUHmvyorVnQ6gl7U0
"""

!apt-get update -qq
!apt-get install fonts-nanum -qq
!fc-cache -fv
!rm ~/.cache/matplotlib -rf

!pip install streamlit

import matplotlib.pyplot as plt
import numpy as np
import matplotlib.font_manager as fm

font_path = '/usr/share/fonts/truetype/nanum/NanumGothic.ttf'
fontprop = fm.FontProperties(fname=font_path, size=10)
plt.rcParams['font.family'] = 'NanumGothic'
plt.rcParams['axes.unicode_minus'] = False

# ë°ì´í„° ì •ì˜
regions = ['ì„œìš¸', 'ê²½ê¸°', 'ì¸ì²œ', 'ê²½ìƒ', 'ì „ë¼', 'ì¶©ì²­', 'ê°•ì›', 'ì œì£¼']
ev_counts = [83868, 151850, 54398, 80533, 56289, 56029, 21004, 49007]
charger_counts = [60615, 112384, 22349, 90573, 38585, 47247, 13818, 8561]

# ìœ„ì¹˜ ì„¤ì •
x = np.arange(len(regions))
width = 0.35

# ê·¸ë˜í”„ ê°ì²´ ìƒì„±
fig, ax1 = plt.subplots(figsize=(12, 6))

# ì™¼ìª½ yì¶• - ì „ê¸°ì°¨ ë“±ë¡ ëŒ€ìˆ˜
bar1 = ax1.bar(x - width/2, ev_counts, width, label='ì „ê¸°ì°¨ ë“±ë¡ ëŒ€ìˆ˜', color='skyblue')
ax1.set_xlabel('ì§€ì—­')
ax1.set_ylabel('ì „ê¸°ì°¨ ë“±ë¡ ëŒ€ìˆ˜', color='skyblue')
ax1.tick_params(axis='y', labelcolor='skyblue')

# ì˜¤ë¥¸ìª½ yì¶• - ì¶©ì „ê¸° ê°œìˆ˜
ax2 = ax1.twinx()
bar2 = ax2.bar(x + width/2, charger_counts, width, label='ì¶©ì „ê¸° ê°œìˆ˜', color='orange')
ax2.set_ylabel('ì¶©ì „ê¸° ê°œìˆ˜', color='orange')
ax2.tick_params(axis='y', labelcolor='orange')

# xì¶• ì„¤ì •
ax1.set_xticks(x)
ax1.set_xticklabels(regions)

# ì œëª© ë° ë²”ë¡€
plt.title('ì§€ì—­ë³„ ì „ê¸°ì°¨ ë“±ë¡ ëŒ€ìˆ˜ ë° ì¶©ì „ê¸° ê°œìˆ˜ ë¹„êµ')
fig.legend(loc='upper right', bbox_to_anchor=(1,1), bbox_transform=ax1.transAxes)

# ê·¸ë˜í”„ ì¶œë ¥
plt.tight_layout()
plt.show()

!apt-get update -qq
!apt-get install fonts-nanum -qq
!fc-cache -fv
!rm ~/.cache/matplotlib -rf



# Commented out IPython magic to ensure Python compatibility.
# # streamlit_app.py
# %%writefile streamlit_app.py
# import streamlit as st
# import matplotlib.pyplot as plt
# import numpy as np
# import matplotlib.font_manager as fm
# import sqlite3
# import pandas as pd
# 
# font_path = '/usr/share/fonts/truetype/nanum/NanumGothic.ttf'
# fontprop = fm.FontProperties(fname=font_path, size=10)
# plt.rcParams['font.family'] = 'NanumGothic'
# plt.rcParams['axes.unicode_minus'] = False
# 
# st.set_page_config(page_title="ì „ê¸°ì°¨/ì¶©ì „ê¸° ì‹œê°í™”", layout="centered")
# st.title("ğŸ“Š ì§€ì—­ë³„ ì „ê¸°ì°¨ ë“±ë¡ ëŒ€ìˆ˜ ë° ì¶©ì „ê¸° ê°œìˆ˜ ë¹„êµ")
# 
# #sqlite ë©”ëª¨ë¦¬ DB ìƒì„±
# conn = sqlite3.connect(':memory:')
# 
# #sql íŒŒì¼ ì½ê¸°
# with open('/content/ev.sql', 'r', encoding='utf-8') as f:
#     sql_script = f.read()
# 
# #sql ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (í…Œì´ë¸” ìƒì„± + ë°ì´í„° ì‚½ì…)
# conn.executescript(sql_script)
# 
# #ì¿¼ë¦¬ ì‹¤í–‰ í›„ ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ë³€í™˜
# df_charger = pd.read_sql_query('SELECT region, SUM(charger_count) AS charger_count FROM charger WHERE YEAR = 2024 AND MONTH =12 GROUP BY region', conn)
# df_ev = pd.read_sql_query('SELECT region, ev_count FROM ev WHERE YEAR = 2024 AND MONTH=12', conn)
# 
# print(df_charger)
# 
# print(df_ev.head)
# 
# 
# # ğŸ“Œ ë°ì´í„° ë³‘í•©
# df_merged = pd.merge(df_ev, df_charger, on='region')
# 
# # ğŸ“Œ ì •ë ¬ (ì˜µì…˜)
# region_order = ['ì„œìš¸', 'ê²½ê¸°', 'ì¸ì²œ', 'ê²½ìƒ', 'ì „ë¼', 'ì¶©ì²­', 'ê°•ì›', 'ì œì£¼']
# df_merged['region'] = pd.Categorical(df_merged['region'], categories=region_order, ordered=True)
# df_merged = df_merged.sort_values('region')
# 
# # ğŸ“Œ ì‹œê°í™”ìš© ë°ì´í„° ì¶”ì¶œ
# regions = df_merged['region'].tolist()
# ev_counts = df_merged['ev_count'].tolist()
# charger_counts = df_merged['charger_count'].tolist()
# 
# # # ë°ì´í„° ì •ì˜
# # regions = ['ì„œìš¸', 'ê²½ê¸°', 'ì¸ì²œ', 'ê²½ìƒ', 'ì „ë¼', 'ì¶©ì²­', 'ê°•ì›', 'ì œì£¼']
# # ev_counts = [83868, 151850, 54398, 80533, 56289, 56029, 21004, 49007]
# # charger_counts = [60615, 112384, 22349, 90573, 38585, 47247, 13818, 8561]
# 
# # ìœ„ì¹˜ ì„¤ì •
# x = np.arange(len(regions))
# width = 0.35
# 
# # ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
# fig, ax1 = plt.subplots(figsize=(12, 6))
# 
# # ì™¼ìª½ yì¶• - ì „ê¸°ì°¨ ë“±ë¡ ëŒ€ìˆ˜
# bar1 = ax1.bar(x - width/2, ev_counts, width, label='ì „ê¸°ì°¨ ë“±ë¡ ëŒ€ìˆ˜', color='skyblue')
# ax1.set_xlabel('ì§€ì—­')
# ax1.set_ylabel('ì „ê¸°ì°¨ ë“±ë¡ ëŒ€ìˆ˜', color='skyblue')
# ax1.tick_params(axis='y', labelcolor='skyblue')
# 
# # ì˜¤ë¥¸ìª½ yì¶• - ì¶©ì „ê¸° ê°œìˆ˜
# ax2 = ax1.twinx()
# bar2 = ax2.bar(x + width/2, charger_counts, width, label='ì¶©ì „ê¸° ê°œìˆ˜', color='orange')
# ax2.set_ylabel('ì¶©ì „ê¸° ê°œìˆ˜', color='orange')
# ax2.tick_params(axis='y', labelcolor='orange')
# 
# # xì¶• ì„¤ì •
# ax1.set_xticks(x)
# ax1.set_xticklabels(regions)
# 
# # ì œëª© ë° ë²”ë¡€
# plt.title('ì§€ì—­ë³„ ì „ê¸°ì°¨ ë“±ë¡ ëŒ€ìˆ˜ ë° ì¶©ì „ê¸° ê°œìˆ˜ ë¹„êµ')
# fig.legend(loc='upper right', bbox_to_anchor=(1,1), bbox_transform=ax1.transAxes)
# 
# # Streamlitì— ê·¸ë˜í”„ ì¶œë ¥
# st.pyplot(fig)
#

!wget -q -O - ipv4.icanhazip.com

!streamlit run  streamlit_app.py & npx localtunnel --port 8501