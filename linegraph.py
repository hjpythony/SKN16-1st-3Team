# -*- coding: utf-8 -*-
"""ì—°ë„ë³„ì „ê¸°ì°¨ì¶©ì „ê¸°ìˆ˜.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1cw5_qtUERSTyW7FnNEzfj1qOZwv-SREY
"""

from google.colab import drive
drive.mount('/content/drive')

# ë‚˜ëˆ”ê³ ë”• í°íŠ¸ ì„¤ì¹˜ ë° ì„¤ì •
!apt-get update -qq
!apt-get install fonts-nanum -qq
!fc-cache -fv
!rm ~/.cache/matplotlib -rf

!pip install streamlit pandas matplotlib localtunnel

# Commented out IPython magic to ensure Python compatibility.
# %%writefile app.py
# import streamlit as st
# import pandas as pd
# import matplotlib.pyplot as plt
# import sqlite3
# import matplotlib.font_manager as fm
# 
# font_path = '/usr/share/fonts/truetype/nanum/NanumGothic.ttf'
# fontprop = fm.FontProperties(fname=font_path, size=10)
# plt.rcParams['font.family'] = 'NanumGothic'
# plt.rcParams['axes.unicode_minus'] = False
# 
# # ê¸°ë³¸ ì„¤ì •
# st.set_page_config(page_title="EV vs Charger Trend", layout="wide")
# 
# st.title("ğŸ“ˆ ì „ê¸°ì°¨ ë“±ë¡ ìˆ˜ vs ì¶©ì „ê¸° ìˆ˜ ì¶”ì„¸ ê·¸ë˜í”„")
# 
# # SQLite ë©”ëª¨ë¦¬ DB ìƒì„±
# conn = sqlite3.connect(':memory:')
# 
# # sql.sql íŒŒì¼ ì‹¤í–‰
# with open('sql.sql', 'r', encoding='utf-8') as f:
#     sql_script = f.read()
# conn.executescript(sql_script)
# 
# # ev í…Œì´ë¸” ì§‘ê³„
# ev_df = pd.read_sql_query('''
#     SELECT year, month, SUM(ev_count) as total_ev
#     FROM ev
#     GROUP BY year, month
# ''', conn)
# 
# # charger í…Œì´ë¸” ì§‘ê³„
# charger_df = pd.read_sql_query('''
#     SELECT year, month, SUM(charger_count) as total_charger
#     FROM charger
#     GROUP BY year, month
# ''', conn)
# 
# # date ì»¬ëŸ¼ ìƒì„±
# ev_df['date'] = pd.to_datetime(ev_df['year'].astype(str) + '-' + ev_df['month'].astype(str).str.zfill(2))
# charger_df['date'] = pd.to_datetime(charger_df['year'].astype(str) + '-' + charger_df['month'].astype(str).str.zfill(2))
# 
# # ë³‘í•© ë° ì •ë ¬
# merged_df = pd.merge(ev_df[['date', 'total_ev']], charger_df[['date', 'total_charger']], on='date')
# merged_df = merged_df.sort_values('date')
# 
# # Streamlit ê·¸ë˜í”„ ì¶œë ¥
# fig, ax = plt.subplots(figsize=(8, 4))
# ax.plot(merged_df['date'], merged_df['total_ev'], label='EV ë“±ë¡ ìˆ˜', marker='o')
# ax.plot(merged_df['date'], merged_df['total_charger'], label='ì¶©ì „ê¸° ìˆ˜', marker='s')
# # ax.set_title('ì „ê¸°ì°¨ ë“±ë¡ ìˆ˜ ë° ì¶©ì „ê¸° ìˆ˜ ì¶”ì„¸', fontsize=16)
# ax.set_xlabel('ë‚ ì§œ', fontsize=12)
# ax.set_ylabel('ìˆ˜ëŸ‰', fontsize=12)
# ax.grid(True)
# ax.legend()
# plt.xticks(rotation=45)
# 
# st.pyplot(fig)
# 
# # # ë°ì´í„° í™•ì¸ìš©
# # with st.expander("ğŸ“Š ë°ì´í„° ë³´ê¸°"):
# #     renamed_df = merged_df.rename(columns={
# #         'date': 'ë‚ ì§œ',
# #         'total_ev': 'ì „ê¸°ì°¨ ë“±ë¡ ìˆ˜',
# #         'total_charger': 'ì¶©ì „ê¸° ìˆ˜'
# #     })
# #     st.dataframe(renamed_df)
# 
# 
# # # faq
# # # ê°€ìƒì˜ ë°ì´í„°ë² ì´ìŠ¤ (ì‹¤ì œ ì‚¬ìš© ì‹œ ì´ ë¶€ë¶„ì„ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ë¡œ ëŒ€ì²´)
# # database = [
# #     "ì‚¬ê³¼ëŠ” ë¹¨ê°„ìƒ‰ ê³¼ì¼ì…ë‹ˆë‹¤.",
# #     "ë°”ë‚˜ë‚˜ëŠ” ë…¸ë€ìƒ‰ ê³¼ì¼ì…ë‹ˆë‹¤.",
# #     "ì˜¤ë Œì§€ëŠ” ì£¼í™©ìƒ‰ ê³¼ì¼ì…ë‹ˆë‹¤.",
# #     "í¬ë„ëŠ” ë³´ë¼ìƒ‰ ë˜ëŠ” ë…¹ìƒ‰ ê³¼ì¼ì…ë‹ˆë‹¤.",
# #     "í‚¤ìœ„ëŠ” ê°ˆìƒ‰ ê»ì§ˆì— ë…¹ìƒ‰ ì†ì„ ê°€ì§„ ê³¼ì¼ì…ë‹ˆë‹¤."
# # ]
# 
# # # ê²€ìƒ‰ í•¨ìˆ˜
# # def search(query):
# #     return [item for item in database if query.lower() in item.lower()]
# 
# # # ì œëª©
# # st.title("ê³¼ì¼ ê²€ìƒ‰ ì•±")
# 
# # # ê²€ìƒ‰ì–´ ì…ë ¥ì°½
# # query = st.text_input("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”:")
# 
# # # ê²€ìƒ‰ ë²„íŠ¼
# # if st.button("ê²€ìƒ‰"):
# #     if query:
# #         results = search(query)
# #         if results:
# #             st.subheader("ê²€ìƒ‰ ê²°ê³¼:")
# #             for result in results:
# #                 st.write(result)
# #         else:
# #             st.write("ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.")
# #     else:
# #         st.write("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.")
#

import streamlit as st

!wget -q -O - ipv4.icanhazip.com

!streamlit run app.py & npx localtunnel --port 8501

# # í¬ë¡¤ë§ insert
# !apt-get update
# !apt-get install -y chromium-chromedriver
# !pip install selenium pymysql

# from selenium import webdriver
# from selenium.webdriver.chrome.options import Options
# from selenium.webdriver.common.by import By
# import time
# import pymysql
# import sqlite3

# # SQLite ë©”ëª¨ë¦¬ DB ìƒì„±
# conn = sqlite3.connect(':memory:')

# # sql.sql íŒŒì¼ ì‹¤í–‰
# with open('sql.sql', 'r', encoding='utf-8') as f:
#     sql_script = f.read()
# conn.executescript(sql_script)

# options = Options()
# options.add_argument("--headless")
# options.add_argument("--no-sandbox")
# options.add_argument("--disable-dev-shm-usage")

# driver = webdriver.Chrome(options=options)
# driver.get("https://www.kia.com/kr/vehicles/kia-ev/guide/faq")
# time.sleep(3)  # í˜ì´ì§€ ë¡œë”© ëŒ€ê¸°

# faq_data = []

# # ì¹´í…Œê³ ë¦¬ ë°˜ë³µ
# category_buttons = driver.find_elements(By.CSS_SELECTOR, "ul.tab_list > li > button")

# for cat_button in category_buttons:
#     category = cat_button.text.strip()
#     cat_button.click()
#     time.sleep(2)  # ì¹´í…Œê³ ë¦¬ í´ë¦­ í›„ ë¡œë”© ëŒ€ê¸°

#     qna_items = driver.find_elements(By.CSS_SELECTOR, "div.accordion_list > div.item")

#     for item in qna_items:
#         try:
#             # ì§ˆë¬¸ ì—´ê¸°
#             item.click()
#             time.sleep(0.5)

#             question = item.find_element(By.CSS_SELECTOR, "button > strong").text.strip()
#             answer = item.find_element(By.CSS_SELECTOR, "div.panel > div.answer_cont").text.strip()
#             faq_data.append((question, answer, category))
#         except Exception as e:
#             print("Error:", e)
#             continue



# # ë°ì´í„° ì‚½ì…
# insert_sql = "INSERT INTO faq (question, answer, category) VALUES (%s, %s, %s)"
# cursor.executemany(insert_sql, faq_data)

# conn.commit()
# cursor.close()
# conn.close()
# driver.quit()

# print(f"{len(faq_data)}ê°œì˜ FAQê°€ DBì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.")

# import pandas as pd
# df = pd.DataFrame(faq_data, columns=["ì§ˆë¬¸", "ë‹µë³€", "ì¹´í…Œê³ ë¦¬"])
# df.head()